# victoriametrics_ansible_playbook
Playbook для автоматической standalone-установки VictoriaMetrics в режиме кластера

# Перед запуском
Перед запуском данного playbook вам необходимо выполнить следующие шаги:
1. Скачать актуальную версию VictoriaMetrics с официального репозитория [GitHub](https://github.com/VictoriaMetrics/VictoriaMetrics/releases). Данный playbook расчитан на версию VictoriaMetrics с суфиксом "-cluster";
2. После скачивания актуальной версии вам необходимо актуализировать переменную "victorialogs_version" указанную в файле **group_vars/all**. Если вы используете архитектуру ОС отличную от "amd64" не забудьте изменить переменную "arch_os" на актуальную архитектуру;
3. Если ваше ssh подключение требует авторизации с использованием сертификата, добавьте сертификат в директорию **ssh_key/victoriametrics**;
4. Актуализировать инвентаризационный файл **hosts** указав в нём актуальные: 
    - Dns имена;
    - Ip адреса;
    - Пользователей;
    - Ssh ключи.

# Запуск playbook
После проведения шагов указанных выше, вы можете запустить playbook, находясь в корневой директории проекта, с использованием команды:

```
ansible-playbook -i hosts main.yml --tags "<your_tag>"
```
В поле "tags" вы можете передать один из следующих тегов:
| Тэг | Описание задачи |
|--------------------|--------------------|
| all         | Полная установка VictoriaMetrics в режиме кластера        |
| victoriametrics        | Копирование исходников VictoriaMetrics и создание необходимых пользователей         |
| vmstorage         | Настройка сервиса vmstorage          |
| vminsert         | Настройка сервиса vminsert          |
| vmselect         | Настройка сервиса vmselect          |

**Стоит обратить внимание, что корректная работа тегов: vmstorage, vminsert, vmselect возможна лишь в том случае, если ранее на сервере была проведена подготовка с помощью тега victoriametrics.**
